---
sidebarDepth: 0
---
# 微服务解决复杂问题

​	　**微服务**的最大进步在于改变了我们的工作方式，敏捷软件开发技术、应用迁移云端、DevOps文化、持续集成与持续部署（CI/CD）和容器应用都使用了微服务来革新应用开发与交付。微服务发展趋势是向**标准化微服务框架**发展，目前常见的三种微服务解决方案如下：

```
Spring Boot + Spring Cloud Alibaba
Spring Boot + Dubbo + Zookeeper 
Spring Boot + Spring Cloud Netflix 目前已停止更新，只进行维护
```

​	　**云计算服务**可以为微服务、大数据提供运维技术支持，云计算可以分为基础设施即服务（IaaS）、平台即服务（PaaS）、软件即服务（SaaS）、区块链即服务（BaaS）。



> **Ref**：[讲义](https://www.funtl.com/zh/guide/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%A7%A3%E5%86%B3%E5%A4%8D%E6%9D%82%E9%97%AE%E9%A2%98.html) | [视频合辑](https://www.bilibili.com/video/av29384041) 

**文档：**

- [微服务从设计到部署](https://github.com/senghoo/golang-design-pattern)
- [重构-改善既有代码的设计](http://gdut_yy.gitee.io/doc-refact2/)
- 研磨设计模式



## 走进单体地狱

​	　单体应用多用于 **项目规模较小、用户较少** 或者 企业内部使用的应用，不适合开发具有高可用、高并发、高性能特性的互联网应用。

```
① 开发：IDE专注于构建单体应用，可以很容易开发风格类似的单体应用模型
② 测试：单体应用可以快速启动并使用如 Selenium 测试包来测试 UI 以轻松地实现端到端测试
③ 发布：应用程序被作为一个单体易于打包和部署，只需拷贝打包好的应用程序到服务器上运行即可
④ 运维：通过运行多个副本和结合负载均衡器，可以很方便的扩展单体应用
```

​	　在项目的早期阶段，使用单体应用开发`互联网应用`也可以良好运作。但随着时间推移，小而简单的应用将会逐渐成长成一个**庞大**、**复杂**的单体，应用程序变得难以扩展，不可靠。

```
① 敏捷开发和交付的任何一次尝试都将原地徘徊，正确修复 bug 和实现新功能变得非常困难而耗时
② 应用启动时间的不断变长和因变更所需要进行的大量测试，导致复杂单体持续部署变得非常困难
③ 当不同模块存在资源（CPU密集型和内存密集型）需求冲突时，单体应用可能难以扩展
④ 任何模块的一个bug都可能会拖垮整个进程，影响到整个应用的可用性
⑤ 单体应用使得采用新框架和语言变得非常困难
```



## 微服务解决复杂问题

​	　微服务将单体应用根据业务需求**充分分解**成一套**较小的互连服务**，以实现松耦合，**达到应用敏捷开发和部署的目的**。每一个服务可以根据不同的业务需求选择**相适应业务**的**数据库模式**  和 **用例部署场景**。

​	　**每个服务可由多个服务实例组成**，每个服务实例是一个Docker容器，为了实现高可用，容器是在多个云虚拟机上运行的。通过**服务发现机制**使得服务能够发现**需要与之通信的任何其他服务的位置**（主机和端口）。不同的服务用例之间不能直接通过 REST API 访问，而是需要通过 **API 网关** (API Gateway) 进行**异步、基于消息的通信**(跨实例分发请求)，**API 网关负责负载均衡、缓存、访问控制、 API 计量和监控**， 可以通过使用`NGINX` 来实现。



（1） 自动微服务部署

​	　一个单体应用可以很容易地部署到基于传统负载均衡器的一组相同服务器上，每个应用程序实例都配置基础设施服务的位置（主机和端口），比如数据库和消息代理。

​	　相比之下，微服务应用程序通常由大量的服务组成，每个服务都有多个运行时实例、还有更多的移动部件需要配置、部署、扩展和监控。因此，要成功部署微服务应用程序，需要求开发人员能**高度控制部署方式**和**高度自动化**。一种自动化方式是使用现成的PaaS，如 Cloud Foundry；另一个方式是使用Kubernetes集群方案开发自己的 PaaS。



（2） CPA理论

​	　CAP 理论指一个分布式系统最多只能同时满足**一致性**（Consistency）、**可用性**（Availability）和**分区容错性**（Partition tolerance）这**三项中的两项**。互联网应用常见的是必须保证C，P和A可根据业务选择。

```
① 一致性：更新操作成功并返回客户端完成后，所有节点在同一时间的数据完全一致
② 可用性：服务一直可用，而且是正常响应时间
③ 分区容错性：在遇到某节点或网络分区故障时，仍能对外提供满足一致性和可用性的服务
```



（3） 微服务优缺点

① 微服务的优点

```
① 使用微服务架构模式，个体服务能被更快地开发，并更容易理解与维护
② 开发者可以自由选择与当前业务需求相适应的技术，此外使用当前技术重写旧服务将变得更加可行
③ 微服务可以实现每个微服务独立部署，使得变更一经测试即可立即部署
④ 微服务架构模式使得每个服务能够独立扩展，使用与服务资源要求最匹配的硬件
```

② 微服务的缺点

```shell
① 容易过多偏向于小型化服务的规模，而忽略充分分解业务需求以方便应用敏捷开发和部署的目标
② 微服务是一个分布式系统，其使得整体变得复杂，容易出现局部故障
③ 分区数据库架构难以实现分布式事务，不得不使用基于最终一致性的方法保证数据的一致性
④ 测试某个微服务的功能时，需要启动该服务及其所依赖的所有服务
⑤ 实现跨服务需求变更时，需要仔细规划和协调出现的变更至每个服务
⑥ 部署基于微服务的应用程序是相当复杂的，需要求开发人员能 高度控制部署方式 和 高度自动化
```



## 再谈微服务


