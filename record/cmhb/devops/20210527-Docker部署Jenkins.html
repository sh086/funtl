<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker部署Jenkins | 学习笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/college/favicon.ico">
    <meta name="description" content="学习笔记">
    
    <link rel="preload" href="/college/assets/css/0.styles.145c1abc.css" as="style"><link rel="preload" href="/college/assets/js/app.4791414c.js" as="script"><link rel="preload" href="/college/assets/js/2.3514b59d.js" as="script"><link rel="preload" href="/college/assets/js/7.2eb08b64.js" as="script"><link rel="prefetch" href="/college/assets/js/10.cbf00236.js"><link rel="prefetch" href="/college/assets/js/100.09dcb188.js"><link rel="prefetch" href="/college/assets/js/101.49a8160a.js"><link rel="prefetch" href="/college/assets/js/102.dbb19677.js"><link rel="prefetch" href="/college/assets/js/103.69753e3c.js"><link rel="prefetch" href="/college/assets/js/104.833bc029.js"><link rel="prefetch" href="/college/assets/js/105.fabdc0d1.js"><link rel="prefetch" href="/college/assets/js/106.af5b3811.js"><link rel="prefetch" href="/college/assets/js/107.cac99e47.js"><link rel="prefetch" href="/college/assets/js/108.1c6fe39a.js"><link rel="prefetch" href="/college/assets/js/109.381ad06a.js"><link rel="prefetch" href="/college/assets/js/11.59b7f971.js"><link rel="prefetch" href="/college/assets/js/110.15187e07.js"><link rel="prefetch" href="/college/assets/js/111.2eaeaf78.js"><link rel="prefetch" href="/college/assets/js/112.90123e8a.js"><link rel="prefetch" href="/college/assets/js/113.9a717e93.js"><link rel="prefetch" href="/college/assets/js/114.4e5678c0.js"><link rel="prefetch" href="/college/assets/js/115.f1064289.js"><link rel="prefetch" href="/college/assets/js/116.9418cec3.js"><link rel="prefetch" href="/college/assets/js/117.7f13c84b.js"><link rel="prefetch" href="/college/assets/js/118.806299cf.js"><link rel="prefetch" href="/college/assets/js/119.6511ac1e.js"><link rel="prefetch" href="/college/assets/js/12.7b688d63.js"><link rel="prefetch" href="/college/assets/js/120.b4e66a48.js"><link rel="prefetch" href="/college/assets/js/121.6f2105d8.js"><link rel="prefetch" href="/college/assets/js/122.59c5daa6.js"><link rel="prefetch" href="/college/assets/js/123.8b5516ee.js"><link rel="prefetch" href="/college/assets/js/124.61754680.js"><link rel="prefetch" href="/college/assets/js/13.639398c0.js"><link rel="prefetch" href="/college/assets/js/14.ae220b00.js"><link rel="prefetch" href="/college/assets/js/15.6030cc2c.js"><link rel="prefetch" href="/college/assets/js/16.bcad66cb.js"><link rel="prefetch" href="/college/assets/js/17.283b46b9.js"><link rel="prefetch" href="/college/assets/js/18.ba480fb5.js"><link rel="prefetch" href="/college/assets/js/19.2fb7b239.js"><link rel="prefetch" href="/college/assets/js/20.8fc3969c.js"><link rel="prefetch" href="/college/assets/js/21.0d611247.js"><link rel="prefetch" href="/college/assets/js/22.11358e02.js"><link rel="prefetch" href="/college/assets/js/23.6459e5d7.js"><link rel="prefetch" href="/college/assets/js/24.c7d26776.js"><link rel="prefetch" href="/college/assets/js/25.0c78bb81.js"><link rel="prefetch" href="/college/assets/js/26.f0211dcd.js"><link rel="prefetch" href="/college/assets/js/27.b6005405.js"><link rel="prefetch" href="/college/assets/js/28.17977fe7.js"><link rel="prefetch" href="/college/assets/js/29.0c0a2cae.js"><link rel="prefetch" href="/college/assets/js/3.6a48563e.js"><link rel="prefetch" href="/college/assets/js/30.81932840.js"><link rel="prefetch" href="/college/assets/js/31.8058ab26.js"><link rel="prefetch" href="/college/assets/js/32.beb55a34.js"><link rel="prefetch" href="/college/assets/js/33.56069543.js"><link rel="prefetch" href="/college/assets/js/34.34f2199e.js"><link rel="prefetch" href="/college/assets/js/35.1950aa3e.js"><link rel="prefetch" href="/college/assets/js/36.7baf6d24.js"><link rel="prefetch" href="/college/assets/js/37.82e81f94.js"><link rel="prefetch" href="/college/assets/js/38.855f7247.js"><link rel="prefetch" href="/college/assets/js/39.2eb85a4f.js"><link rel="prefetch" href="/college/assets/js/4.fca25402.js"><link rel="prefetch" href="/college/assets/js/40.a429c9c5.js"><link rel="prefetch" href="/college/assets/js/41.e3e08432.js"><link rel="prefetch" href="/college/assets/js/42.5dd13a60.js"><link rel="prefetch" href="/college/assets/js/43.e2dd01c6.js"><link rel="prefetch" href="/college/assets/js/44.6354106c.js"><link rel="prefetch" href="/college/assets/js/45.92adf809.js"><link rel="prefetch" href="/college/assets/js/46.bdb9c838.js"><link rel="prefetch" href="/college/assets/js/47.b6892422.js"><link rel="prefetch" href="/college/assets/js/48.6102d27a.js"><link rel="prefetch" href="/college/assets/js/49.736c69e9.js"><link rel="prefetch" href="/college/assets/js/5.72d0dbe2.js"><link rel="prefetch" href="/college/assets/js/50.8d15425f.js"><link rel="prefetch" href="/college/assets/js/51.5cd305ba.js"><link rel="prefetch" href="/college/assets/js/52.afea97df.js"><link rel="prefetch" href="/college/assets/js/53.44dbfb0c.js"><link rel="prefetch" href="/college/assets/js/54.4f51faec.js"><link rel="prefetch" href="/college/assets/js/55.82dab1bd.js"><link rel="prefetch" href="/college/assets/js/56.99ec3010.js"><link rel="prefetch" href="/college/assets/js/57.5305c097.js"><link rel="prefetch" href="/college/assets/js/58.0604a19b.js"><link rel="prefetch" href="/college/assets/js/59.b8cb8e40.js"><link rel="prefetch" href="/college/assets/js/6.1960beed.js"><link rel="prefetch" href="/college/assets/js/60.83d20ed0.js"><link rel="prefetch" href="/college/assets/js/61.cb196b72.js"><link rel="prefetch" href="/college/assets/js/62.ef5d01e7.js"><link rel="prefetch" href="/college/assets/js/63.325b8085.js"><link rel="prefetch" href="/college/assets/js/64.2e096163.js"><link rel="prefetch" href="/college/assets/js/65.7aa7398c.js"><link rel="prefetch" href="/college/assets/js/66.5282c09a.js"><link rel="prefetch" href="/college/assets/js/67.a14e5efd.js"><link rel="prefetch" href="/college/assets/js/68.69a4fd20.js"><link rel="prefetch" href="/college/assets/js/69.46f28258.js"><link rel="prefetch" href="/college/assets/js/70.aade3054.js"><link rel="prefetch" href="/college/assets/js/71.be945a0f.js"><link rel="prefetch" href="/college/assets/js/72.7b52821c.js"><link rel="prefetch" href="/college/assets/js/73.64d1f9aa.js"><link rel="prefetch" href="/college/assets/js/74.7dd9b1bd.js"><link rel="prefetch" href="/college/assets/js/75.7d15ffe6.js"><link rel="prefetch" href="/college/assets/js/76.7d70176a.js"><link rel="prefetch" href="/college/assets/js/77.6764da83.js"><link rel="prefetch" href="/college/assets/js/78.65c27b1d.js"><link rel="prefetch" href="/college/assets/js/79.d0e04172.js"><link rel="prefetch" href="/college/assets/js/8.17542ebe.js"><link rel="prefetch" href="/college/assets/js/80.ca480228.js"><link rel="prefetch" href="/college/assets/js/81.34ecf148.js"><link rel="prefetch" href="/college/assets/js/82.1c1aaea8.js"><link rel="prefetch" href="/college/assets/js/83.54d671df.js"><link rel="prefetch" href="/college/assets/js/84.07968dea.js"><link rel="prefetch" href="/college/assets/js/85.333efd08.js"><link rel="prefetch" href="/college/assets/js/86.a68d6803.js"><link rel="prefetch" href="/college/assets/js/87.0aeb5f7c.js"><link rel="prefetch" href="/college/assets/js/88.531e4015.js"><link rel="prefetch" href="/college/assets/js/89.febee893.js"><link rel="prefetch" href="/college/assets/js/9.6a0ccc8b.js"><link rel="prefetch" href="/college/assets/js/90.3b63e3ef.js"><link rel="prefetch" href="/college/assets/js/91.dddb6f4b.js"><link rel="prefetch" href="/college/assets/js/92.b8c1fcaa.js"><link rel="prefetch" href="/college/assets/js/93.23f7f5b1.js"><link rel="prefetch" href="/college/assets/js/94.42cf4b48.js"><link rel="prefetch" href="/college/assets/js/95.1f97ed62.js"><link rel="prefetch" href="/college/assets/js/96.1db054ab.js"><link rel="prefetch" href="/college/assets/js/97.e5b19789.js"><link rel="prefetch" href="/college/assets/js/98.ac598659.js"><link rel="prefetch" href="/college/assets/js/99.9e701d80.js">
    <link rel="stylesheet" href="/college/assets/css/0.styles.145c1abc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/college/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/college/blog/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="/college/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/college/project/" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/college/data/" class="nav-link">
  数据科学
</a></div><div class="nav-item"><a href="/college/workflow/" class="nav-link">
  工作流
</a></div> <a href="https://github.com/sh086/college" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/college/blog/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="/college/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/college/project/" class="nav-link">
  项目
</a></div><div class="nav-item"><a href="/college/data/" class="nav-link">
  数据科学
</a></div><div class="nav-item"><a href="/college/workflow/" class="nav-link">
  工作流
</a></div> <a href="https://github.com/sh086/college" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Docker部署Jenkins</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/college/record/cmhb/devops/20210527-Docker%E9%83%A8%E7%BD%B2Jenkins.html#环境准备" class="sidebar-link">环境准备</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/college/record/cmhb/devops/20210527-Docker%E9%83%A8%E7%BD%B2Jenkins.html#启动jenkins" class="sidebar-link">启动Jenkins</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/college/record/cmhb/devops/20210527-Docker%E9%83%A8%E7%BD%B2Jenkins.html#jenkins配置" class="sidebar-link">Jenkins配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/college/record/cmhb/devops/20210527-Docker%E9%83%A8%E7%BD%B2Jenkins.html#插件安装" class="sidebar-link">插件安装</a></li><li class="sidebar-sub-header"><a href="/college/record/cmhb/devops/20210527-Docker%E9%83%A8%E7%BD%B2Jenkins.html#maven" class="sidebar-link">Maven</a></li><li class="sidebar-sub-header"><a href="/college/record/cmhb/devops/20210527-Docker%E9%83%A8%E7%BD%B2Jenkins.html#publish-over-ssh" class="sidebar-link">Publish Over SSH</a></li></ul></li><li><a href="/college/record/cmhb/devops/20210527-Docker%E9%83%A8%E7%BD%B2Jenkins.html#项目部署" class="sidebar-link">项目部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/college/record/cmhb/devops/20210527-Docker%E9%83%A8%E7%BD%B2Jenkins.html#源码管理" class="sidebar-link">源码管理</a></li><li class="sidebar-sub-header"><a href="/college/record/cmhb/devops/20210527-Docker%E9%83%A8%E7%BD%B2Jenkins.html#构建" class="sidebar-link">构建</a></li></ul></li><li><a href="/college/record/cmhb/devops/20210527-Docker%E9%83%A8%E7%BD%B2Jenkins.html#附录" class="sidebar-link">附录</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="docker部署jenkins"><a href="#docker部署jenkins" class="header-anchor">#</a> Docker部署Jenkins</h1> <p><strong>参考：</strong></p> <ul><li><a href="https://hub.docker.com/_/jenkins" target="_blank" rel="noopener noreferrer">Jenkins部署方式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://segmentfault.com/a/1190000038648097" target="_blank" rel="noopener noreferrer">docker+jenkins实现自动化部署<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="环境准备"><a href="#环境准备" class="header-anchor">#</a> 环境准备</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>Linux：CentOS Linux release 7.9.2009
Docker版本 ：1.13.1
Jdk版本 ：1.8.0_161
Maven版本：3.8.1
jenkisn版本：lts（最新版）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​		接着，需要通过如下命令检查安装Jenkins的机器是否可以访问部署服务的机器。满足安装条件后，才能继续安装Jenkins。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">ssh</span> root@10.10.144.6
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​		建议使用root用户 或者 具有root权限的用户，完成本次部署，</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 新建用户</span>
adduser crmtest
<span class="token function">passwd</span> crmtest
<span class="token comment"># 添加crmtest到root组</span>
<span class="token function">usermod</span> -g root crmtest
<span class="token comment"># 修改 /etc/passwd 文件，找到如下行，把用户ID修改为 0 ，赋予用户root权限</span>
<span class="token function">vi</span> /etc/passwd
crmtest:x:0:0::/home/crmtest:/bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="启动jenkins"><a href="#启动jenkins" class="header-anchor">#</a> 启动Jenkins</h2> <p>​		首先，需要下载最新版Jenkins镜像</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>docker pull jenkins<span class="token operator">/</span>jenkins:lts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​		接着，需要新建<code>jenkins_home</code>持久化目录，使得重启<code>Jenkins</code>后仍可以保持Jenkins中的配置。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">mkdir</span> /var/jenkins_home
<span class="token comment"># 为jenkins_home目录赋权</span>
<span class="token function">chown</span> -R <span class="token number">1000</span>:1000 /var/jenkins_home
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​		然后，就可以通过<code>docker run</code> 命令启动Jenkins了。特别的，此处我们配置的Jenkins访问端口是<code>8081</code>端口，大家可以自定义该端口。启动完成后，通过在浏览器中输入http://10.10.144.6:8081，即可访问Jenkins。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 启动命令</span>
docker run  <span class="token punctuation">\</span>
-d --name jenkins  <span class="token punctuation">\</span>
-p <span class="token number">8081</span>:8080  <span class="token punctuation">\</span>
-v /var/jenkins_home:/var/jenkins_home  <span class="token punctuation">\</span>
jenkins/jenkins:lts
<span class="token comment"># 查看Jenkins启动情况</span>
docker <span class="token function">ps</span> <span class="token operator">|</span> <span class="token function">grep</span> jenkins<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>​		初次访问需要解锁Jenkins，解锁密码在启动 <strong>日志中</strong> 或 <strong>容器内部</strong> 中都可以查到。解锁成功后，选择<code>安装推荐的插件</code>，然后静待插件安装完成。最后，进入设置用户密码页面，设置完成后即可使用此用户密码登录Jenkins。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 查看日志</span>
docker logs -f jenkins
<span class="token comment"># 进入容器</span>
docker <span class="token builtin class-name">exec</span> -it jenkins <span class="token function">bash</span>
<span class="token function">cat</span> /var/jenkins_home/secrets/initialAdminPassword
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="jenkins配置"><a href="#jenkins配置" class="header-anchor">#</a> Jenkins配置</h2> <h3 id="插件安装"><a href="#插件安装" class="header-anchor">#</a> 插件安装</h3> <p>​	在<code>系统管理</code>中，点击<code>插件管理</code>，安装如下插件，安装完成后，请重启Jenkins。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Git Parameter
Publish Over SSH
Maven Integration
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="maven"><a href="#maven" class="header-anchor">#</a> Maven</h3> <p>​		由于Jenkins是通过Dokcer部署的，所以本次将Maven安装到<code>/var/jenkins_home</code>目录下。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /var/jenkins_home
<span class="token comment"># 下载maven并解压</span>
<span class="token function">tar</span> zxvf apache-maven-3.8.1-bin.tar.gz
<span class="token function">chown</span> -R <span class="token number">1000</span>:1000 apache-maven-3.8.1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>​		点击<code>系统管理</code> -&gt; <code>全局工具配置</code>，在Maven标签中点击新增Maven按钮，然后输入Maven名称，并设定<code>Maven_HOME</code>。</p> <p><img src="/college/assets/img/20210528165412863.4a10c89b.png" alt="image-20210528165412863"></p> <p>补充说明知识点：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 设置JAVA_HOME的方法</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/var/jenkins_home/jdk
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">${JAVA_HOME}</span>/bin:<span class="token environment constant">$PATH</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="publish-over-ssh"><a href="#publish-over-ssh" class="header-anchor">#</a> Publish Over SSH</h3> <p>​		点击<code>系统管理</code> -&gt; <code>系统配置</code>，在<code>系统配置</code>中找到<code>Publish over SSH</code>，然后，配置应用部署机器<code>10.10.144.6</code>的用户名、密码等基本信息。配置完成后通过点击<code>Test Configuration</code>按钮可以测试是否服务器是否连通，若不联通，则表明配置有问题或者该Jenkins无法对该机器进行部署。</p> <p><img src="/college/assets/img/image-20210528170008662.41bb8220.png" alt="image-20210528170008662"></p> <h2 id="项目部署"><a href="#项目部署" class="header-anchor">#</a> 项目部署</h2> <h3 id="源码管理"><a href="#源码管理" class="header-anchor">#</a> 源码管理</h3> <p>​		输入需要部署的项目地址，并<code>添加</code>认证方式后，选择指定分支。</p> <p><img src="/college/assets/img/image-20210528172649483.3fc9dce1.png" alt="image-20210528172649483"></p> <h3 id="构建"><a href="#构建" class="header-anchor">#</a> 构建</h3> <p>​		选择刚才设置的远程服务器<code>CRM工单测试</code>，然后在<code>Source files</code>中设置需要传输文件的相对路径，在<code>Remove Prefix</code>中设置需要传输文件的目录前缀。最后，设置构建完成后，所需执行的命令即可完成。特别的，需要在高级中勾选<code>Verbose output in cnsole</code>打印完整日志，以便排错。</p> <p><img src="/college/assets/img/image-20210528173816758.5f97329e.png" alt="image-20210528173816758"></p> <h2 id="附录"><a href="#附录" class="header-anchor">#</a> 附录</h2> <p>​		由于运维不让使用root权限进行部署，所以，需要将crmtest重新改回普通用户组、普通用户权限。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 新建crmtest用户组（可跳过）</span>
<span class="token function">groupadd</span> crmtest
<span class="token comment"># 将crmtest添加到crmtest用户组</span>
<span class="token function">usermod</span> -g crmtest crmtest
<span class="token comment"># 查看crmtest用户信息</span>
<span class="token function">id</span> crmtest
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">8888</span><span class="token punctuation">(</span>crmtest<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>jenkins<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>jenkins<span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​		接着，需要重新新建<code>/home/crmtest</code>目录，并为<code>crmtest</code>、<code>crm-api</code>、<code>work-order</code>设置用户和用户组权限。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">mkdir</span> /home/crmtest
<span class="token comment"># 目录赋权</span>
<span class="token function">chown</span> -R crmtest crmtest
<span class="token function">chgrp</span> -R crmtest crmtest
<span class="token function">chown</span> -R crmtest crm-api
<span class="token function">chgrp</span> -R crmtest crm-api
<span class="token function">chown</span> -R crmtest work-order
<span class="token function">chgrp</span> -R crmtest work-order
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>​		最后，若想用户<code>crmtest</code>允许执行<code>docker</code>命令，可以通过如下两个方法解决。执行完成后，就可以<code>Jenkins</code>就能部署成功了。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 方法一</span>
<span class="token function">sudo</span> <span class="token function">groupadd</span> docker     <span class="token comment">#添加docker用户组</span>
<span class="token function">sudo</span> gpasswd -a crmtest docker     <span class="token comment">#将登陆用户加入到docker用户组中</span>
newgrp docker     <span class="token comment">#更新用户组</span>
docker <span class="token function">ps</span>    <span class="token comment">#测试docker命令是否可以使用sudomkdir /home/crmtest</span>
<span class="token comment"># 方法二</span>
<span class="token function">chmod</span> a+rw /var/run/docker.sock 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/college/assets/js/app.4791414c.js" defer></script><script src="/college/assets/js/2.3514b59d.js" defer></script><script src="/college/assets/js/7.2eb08b64.js" defer></script>
  </body>
</html>
